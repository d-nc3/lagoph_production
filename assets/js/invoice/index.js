'use strict';$(function(){var dt_invoice_table=$('.invoice-list-table');var table=$('.datatables-transactions'),select2Filters=$('.select2-filters'),select2=$('.select2');if(select2Filters.length){select2Filters.each(function(){var $this=$(this);$this.wrap('<div class="position-relative"></div>').select2({placeholder:'Select All',dropdownParent:$this.parent(),});$this.on('change',function(e){e.preventDefault();dt.draw()})})}
if(select2.length){select2.each(function(){var $this=$(this);$this.wrap('<div class="position-relative"></div>').select2({placeholder:'Select Value',dropdownParent:$this.parent(),})})}
if(table.length){var dt=table.DataTable({lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],processing:!0,serverSide:!0,ajax:{url:`${BASE_URL}Cashiering /dt_list`,type:"POST",data:function(d){d.department_id=$("#transaction-type-id").val()}},columns:[{data:''},{data:'cashiering_invoice_id'},{data:'quantity'},{data:'item_id'},{data:'unit_price'},{data:'total_amount'},{data:'action'}],columnDefs:[{className:'control',responsivePriority:2,searchable:!1,targets:0,render:function(data,type,full,meta){return''}},{targets:1,render:function(data,type,full,meta){var $invoice_id=full.cashiering_invoice_id;var $row_output=`<a href="${BASE_URL}Cashiering/view/" + ${$invoice_id} </a>`;return $row_output}},{targets:2,render:function(data,type,full,meta){var $invoice_status=full.quantity,$due_date=full.due_date,$balance=full.balance;var roleBadgeObj={Sent:'<span class="badge badge-center rounded-pill bg-label-secondary w-px-30 h-px-30"><i class="bx bx-paper-plane bx-xs"></i></span>',Draft:'<span class="badge badge-center rounded-pill bg-label-primary w-px-30 h-px-30"><i class="bx bxs-save bx-xs"></i></span>','Past Due':'<span class="badge badge-center rounded-pill bg-label-danger w-px-30 h-px-30"><i class="bx bx-info-circle bx-xs"></i></span>','Partial Payment':'<span class="badge badge-center rounded-pill bg-label-success w-px-30 h-px-30"><i class="bx bx-adjust bx-xs"></i></span>',Paid:'<span class="badge badge-center rounded-pill bg-label-warning w-px-30 h-px-30"><i class="bx bx-pie-chart-alt bx-xs"></i></span>',Downloaded:'<span class="badge badge-center rounded-pill bg-label-info w-px-30 h-px-30"><i class="bx bx-down-arrow-circle bx-xs"></i></span>'};return("<span data-bs-toggle='tooltip' data-bs-html='true' title='<span>"+$invoice_status+'<br> <span class="fw-medium">Balance:</span> '+$balance+'<br> <span class="fw-medium">Due Date:</span> '+$due_date+"</span>'>"+roleBadgeObj[$invoice_status]+'</span>')}},{targets:3,render:function(data,type,full,meta){var $email=full.unit_price;return'<span class="d-none">'+$email+'</span>$'+$total}},{targets:4,orderable:!1,render:function(data,type,full,meta){var $status=full.total_amount;if($balance===0){var $badge_class='bg-label-success';return'<span class="badge '+$badge_class+'"> Paid </span>'}else{return'<span class="d-none">'+$balance+'</span>'+$balance}}},{targets:7,visible:!1},{targets:-1,title:'Actions',searchable:!1,orderable:!1,render:function(data,type,full,meta){return('<div class="d-flex align-items-center">'+'<a href="javascript:;" data-bs-toggle="tooltip" class="text-body" data-bs-placement="top" title="Send Mail"><i class="bx bx-send mx-1"></i></a>'+`<a href="${BASE_URL}Cashiering/view/invoice_id "  data-bs-toggle="tooltip" class="text-body" data-bs-placement="top" title="Preview Invoice"><i class="bx bx-show mx-1"></i></a>`+'<div class="dropdown">'+'<a href="javascript:;" class="btn dropdown-toggle hide-arrow text-body p-0" data-bs-toggle="dropdown"><i class="bx bx-dots-vertical-rounded"></i></a>'+'<div class="dropdown-menu dropdown-menu-end">'+'<a href="javascript:;" class="dropdown-item">Download</a>'+'<a href="app-invoice-edit.html" class="dropdown-item">Edit</a>'+'<a href="javascript:;" class="dropdown-item">Duplicate</a>'+'<div class="dropdown-divider"></div>'+'<a href="javascript:;" class="dropdown-item delete-record text-danger">Delete</a>'+'</div>'+'</div>'+'</div>')}}],order:[[1,'desc']],dom:'<"row mx-1"'+'<"col-12 col-md-6 d-flex align-items-center justify-content-center justify-content-md-start gap-3"l<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start mt-md-0 mt-3"B>>'+'<"col-12 col-md-6 d-flex align-items-center justify-content-end flex-column flex-md-row pe-3 gap-md-3"f<"invoice_status mb-3 mb-md-0">>'+'>t'+'<"row mx-2"'+'<"col-sm-12 col-md-6"i>'+'<"col-sm-12 col-md-6"p>'+'>',language:{sLengthMenu:'_MENU_',search:'',searchPlaceholder:'Search Invoice'},buttons:[{text:'<i class="bx bx-plus me-md-1"></i><span class="d-md-inline-block d-none">Create Invoice</span>',className:'btn btn-primary',action:function(e,dt,button,config){window.location=BASE_URL+'Cashiering/add_invoice'}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(row){var data=row.data();return'Details of '+data.full_name}}),type:'column',renderer:function(api,rowIdx,columns){var data=$.map(columns,function(col,i){return col.title!==''?'<tr data-dt-row="'+col.rowIndex+'" data-dt-column="'+col.columnIndex+'">'+'<td>'+col.title+':'+'</td> '+'<td>'+col.data+'</td>'+'</tr>':''}).join('');return data?$('<table class="table"/><tbody />').append(data):!1}}},initComplete:function(){this.api().columns(7).every(function(){var column=this;var select=$('<select id="UserRole" class="form-select"><option value=""> Select Status </option></select>').appendTo('.invoice_status').on('change',function(){var val=$.fn.dataTable.util.escapeRegex($(this).val());column.search(val?'^'+val+'$':'',!0,!1).draw()});column.data().unique().sort().each(function(d,j){select.append('<option value="'+d+'" class="text-capitalize">'+d+'</option>')})})}})}
dt_invoice_table.on('draw.dt',function(){var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));var tooltipList=tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl,{boundary:document.body})})});$('.invoice-list-table tbody').on('click','.delete-record',function(){dt_invoice.row($(this).parents('tr')).remove().draw()});setTimeout(()=>{$('.dataTables_filter .form-control').removeClass('form-control-sm');$('.dataTables_length .form-select').removeClass('form-select-sm')},300)})