"use strict";$(function(){var table=$(".datatables-payment");const userId=$("#userId").val();if(table.length){var dt=table.DataTable({lengthMenu:[[10,25,50,-1],[10,25,50,"All"],],processing:!0,serverSide:!0,ajax:{url:`${BASE_URL}Payment/payment_dt_list/${userId}`,type:"POST",data:function(d){},},columns:[{data:null},{data:"id"},{data:"name"},{data:"payment_date"},{data:"status"},{data:null},],columnDefs:[{targets:0,className:"control",searchable:!1,orderable:!1,responsivePriority:2,render:function(data,type,full,meta){return""},},{targets:1,render:function(data,type,full,meta){var $id=full.id;return"<span>"+$id+"</span>"},},{targets:2,responsivePriority:4,render:function(data,type,full,meta){var $user_name=full.first_name+full.last_name;return"<span>"+$user_name+"</span>"},},{targets:3,render:function(data,type,full,meta){var $payment_date=full.payment_date;return"<span>"+$payment_date+"</span>"},},{targets:4,render:function(data,type,full,meta){var status=full.status;var statusClass="";switch(status.toLowerCase()){case "completed":statusClass="badge bg-success";break;case "pending":statusClass="badge bg-warning";break;case "overdue":statusClass="badge bg-danger";break;default:statusClass="badge bg-secondary"}
return `<span class="${statusClass}">${status}</span>`},},{targets:-1,title:"Actions",searchable:!1,orderable:!1,className:"text-center",render:function(data,type,full,meta){return('<div class="d-inline-block text-nowrap">'+'<a href="javascript:void(0)" data-id="'+full.id+'" class="btn btn-sm btn-icon view_data" title="View item details"><i class="bx bx-show"></i></a>'+"</div>")},},],order:[[0,"asc"]],});dt.on("draw",function(){handleGetItem()});dt.on("responsive-display",function(){handleGetItem()})}
var fetchDetails=function(url,itemId,successCallback,clearCallback){if(itemId){$.ajax({url:`${BASE_URL}${url}`,type:"POST",data:{id:itemId},dataType:"json",success:successCallback,error:function(){alert("Failed to fetch item details")},})}else{clearCallback()}};$(document).on("change",".items",function(){var itemId=$(this).val();var repeaterItem=$(this).closest("[data-repeater-item]");fetchDetails("Cashiering/get_item",itemId,function(data){repeaterItem.find(".item-price").val(data.amount);updateTotalPrice(repeaterItem)},function(){repeaterItem.find(".item-price").val("");repeaterItem.find(".total-price").val("")})});$(document).on("input",".item-qty",function(){var repeaterItem=$(this).closest("[data-repeater-item]");updateTotalPrice(repeaterItem)});var calculateTotalSum=()=>{var totalSum=0;$("[data-repeater-item]").each(function(){var itemTotal=parseFloat($(this).find(".total-price").val())||0;totalSum+=itemTotal});$("#subTotal").text(totalSum.toFixed(2));$("#total").text(totalSum.toFixed(2))};function updateTotalPrice(repeaterItem){var quantity=parseFloat(repeaterItem.find(".item-qty").val())||0;var price=parseFloat(repeaterItem.find(".item-price").val())||0;var totalPrice=quantity*price;repeaterItem.find(".total-price").val(totalPrice.toFixed(2));calculateTotalSum()}
$(".view_data").on("click",function(e){e.preventDefault();var itemId=$(this).val("data-id");if(!itemId){console.error("Item ID not found");return}});var handleGetItem=function(){const view_invoice=document.querySelectorAll(".view_data");view_invoice.forEach((d)=>{d.addEventListener("click",function(e){e.preventDefault();const id=$(this).data("id");showBlockUI();$.ajax({url:`${BASE_URL}Cashiering/get_item_data`,type:"POST",async:!0,data:{id:id},dataType:"json",success:function(response){hideBlockUI();if(response){$("#itemDetails").val(response.item_id).trigger("change");$("#itemPrice").val(response.unit_cost);$("#itemQuantity").val(response.quantity);$("#unit").val(response.unit);$("#itemTotal").val(response.total_cost);$("#referenceNo").val(response.reference_number);$("#accountNum").val(response.account_number);$("#accountName").val(response.account_name);$("#totalPayment").val(response.total_payment);$("#paymentMethod").val(response.payment_method_id).trigger("change");$("#paymentMode").val(response.payment_type_id).trigger("change")}else{Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary",},})}},error:function(xhr){hideBlockUI();Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary",},})},})})})}})